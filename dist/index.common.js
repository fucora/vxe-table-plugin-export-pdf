"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginExportPDF = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils/methods/xe-utils"));

var _jspdf = _interopRequireDefault(require("jspdf"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function exportPDF(params) {
  var colWidth = 0;
  var $table = params.$table,
      options = params.options,
      columns = params.columns,
      datas = params.datas;
  var type = options.type,
      filename = options.filename,
      isHeader = options.isHeader,
      isFooter = options.isFooter,
      original = options.original,
      message = options.message,
      footerFilterMethod = options.footerFilterMethod;
  var colHead = {};
  var footList = [];
  var headers = columns.map(function (column) {
    var title = _xeUtils["default"].toString(original ? column.property : column.getTitle()) || ' ';
    colWidth += column.renderWidth;

    if (isHeader) {
      colHead[column.id] = title;
    }

    return {
      name: column.id,
      prompt: title,
      width: column.renderWidth
    };
  });
  var colRatio = colWidth / 100;
  headers.forEach(function (column) {
    column.width = Math.floor(column.width / colRatio * 4) - 1;
  });
  var rowList = datas.map(function (row, rowIndex) {
    var item = {};
    columns.forEach(function (column, columnIndex) {
      var cellValue;
      var property = column.property;
      var isIndex = column.type === 'index';

      if (!original || isIndex) {
        cellValue = isIndex ? column.indexMethod ? column.indexMethod({
          row: row,
          rowIndex: rowIndex,
          column: column,
          columnIndex: columnIndex
        }) : rowIndex + 1 : row[column.id];
      } else {
        cellValue = _xeUtils["default"].get(row, property);
      }

      item[column.id] = _xeUtils["default"].toString(cellValue) || ' ';
    });
    return item;
  });

  if (isFooter) {
    var footerData = $table.footerData;
    var footers = footerFilterMethod ? footerData.filter(footerFilterMethod) : footerData;
    footers.forEach(function (rows) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = _xeUtils["default"].toString(rows[$table.getColumnIndex(column)]) || ' ';
      });
      footList.push(item);
    });
  } // 转换pdf


  var doc = new _jspdf["default"]({
    putOnlyUsedFonts: true,
    orientation: 'landscape'
  });
  doc.table(1, 1, (isHeader ? [colHead] : []).concat(rowList).concat(footList), headers, {
    printHeaders: false,
    autoSize: false
  });
  doc.save("".concat(filename, ".").concat(type));

  if (message !== false) {
    $table.$XModal.message({
      message: i18n('vxe.table.expSuccess'),
      status: 'success'
    });
  }
}

function handleExportEvent(params) {
  if (params.options.type === 'pdf') {
    exportPDF(params);
    return false;
  }
}
/**
 * 基于 vxe-table 表格的增强插件，支持导出 pdf 格式
 */


var VXETablePluginExportPDF = {
  install: function install(xtable) {
    Object.assign(xtable.types, {
      pdf: 0
    });
    xtable.interceptor.mixin({
      'event.export': handleExportEvent
    });
    VXETablePluginExportPDF.t = xtable.t;
  }
};
exports.VXETablePluginExportPDF = VXETablePluginExportPDF;

function i18n(key) {
  if (VXETablePluginExportPDF.t) {
    return VXETablePluginExportPDF.t(key);
  }
}

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginExportPDF);
}

var _default = VXETablePluginExportPDF;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImV4cG9ydFBERiIsInBhcmFtcyIsImNvbFdpZHRoIiwiJHRhYmxlIiwib3B0aW9ucyIsImNvbHVtbnMiLCJkYXRhcyIsInR5cGUiLCJmaWxlbmFtZSIsImlzSGVhZGVyIiwiaXNGb290ZXIiLCJvcmlnaW5hbCIsIm1lc3NhZ2UiLCJmb290ZXJGaWx0ZXJNZXRob2QiLCJjb2xIZWFkIiwiZm9vdExpc3QiLCJoZWFkZXJzIiwibWFwIiwiY29sdW1uIiwidGl0bGUiLCJYRVV0aWxzIiwidG9TdHJpbmciLCJwcm9wZXJ0eSIsImdldFRpdGxlIiwicmVuZGVyV2lkdGgiLCJpZCIsIm5hbWUiLCJwcm9tcHQiLCJ3aWR0aCIsImNvbFJhdGlvIiwiZm9yRWFjaCIsIk1hdGgiLCJmbG9vciIsInJvd0xpc3QiLCJyb3ciLCJyb3dJbmRleCIsIml0ZW0iLCJjb2x1bW5JbmRleCIsImNlbGxWYWx1ZSIsImlzSW5kZXgiLCJpbmRleE1ldGhvZCIsImdldCIsImZvb3RlckRhdGEiLCJmb290ZXJzIiwiZmlsdGVyIiwicm93cyIsImdldENvbHVtbkluZGV4IiwicHVzaCIsImRvYyIsImpzUERGIiwicHV0T25seVVzZWRGb250cyIsIm9yaWVudGF0aW9uIiwidGFibGUiLCJjb25jYXQiLCJwcmludEhlYWRlcnMiLCJhdXRvU2l6ZSIsInNhdmUiLCIkWE1vZGFsIiwiaTE4biIsInN0YXR1cyIsImhhbmRsZUV4cG9ydEV2ZW50IiwiVlhFVGFibGVQbHVnaW5FeHBvcnRQREYiLCJpbnN0YWxsIiwieHRhYmxlIiwiT2JqZWN0IiwiYXNzaWduIiwidHlwZXMiLCJwZGYiLCJpbnRlcmNlcHRvciIsIm1peGluIiwidCIsImtleSIsIndpbmRvdyIsIlZYRVRhYmxlIiwidXNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7Ozs7QUFFQSxTQUFTQSxTQUFULENBQW1CQyxNQUFuQixFQUE4QjtBQUM1QixNQUFJQyxRQUFRLEdBQVcsQ0FBdkI7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QkFBdUIsQ0FBQ1MsQ0FBeEIsQ0FBMEJDLEdBQTFCLENBQVA7QUFDRDtBQUNGOztBQUVELElBQUksT0FBT0MsTUFBUCxLQUFrQixXQUFsQixJQUFpQ0EsTUFBTSxDQUFDQyxRQUE1QyxFQUFzRDtBQUNwREQsRUFBQUEsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxHQUFoQixDQUFvQmIsdUJBQXBCO0FBQ0Q7O2VBRWNBLHVCIiwiZmlsZSI6ImluZGV4LmNvbW1vbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBYRVV0aWxzIGZyb20gJ3hlLXV0aWxzL21ldGhvZHMveGUtdXRpbHMnXHJcbmltcG9ydCBWWEVUYWJsZSBmcm9tICd2eGUtdGFibGUvbGliL3Z4ZS10YWJsZSdcclxuaW1wb3J0IGpzUERGIGZyb20gJ2pzcGRmJ1xyXG5cclxuZnVuY3Rpb24gZXhwb3J0UERGKHBhcmFtczogYW55KSB7XHJcbiAgbGV0IGNvbFdpZHRoOiBudW1iZXIgPSAwXHJcbiAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMsIGNvbHVtbnMsIGRhdGFzIH0gPSBwYXJhbXNcclxuICBjb25zdCB7IHR5cGUsIGZpbGVuYW1lLCBpc0hlYWRlciwgaXNGb290ZXIsIG9yaWdpbmFsLCBtZXNzYWdlLCBmb290ZXJGaWx0ZXJNZXRob2QgfSA9IG9wdGlvbnNcclxuICBjb25zdCBjb2xIZWFkOiBhbnkgPSB7fVxyXG4gIGNvbnN0IGZvb3RMaXN0OiBhbnlbXSA9IFtdXHJcbiAgY29uc3QgaGVhZGVyczogYW55W10gPSBjb2x1bW5zLm1hcCgoY29sdW1uOiBhbnkpID0+IHtcclxuICAgIGNvbnN0IHRpdGxlOiBzdHJpbmcgPSBYRVV0aWxzLnRvU3RyaW5nKG9yaWdpbmFsID8gY29sdW1uLnByb3BlcnR5IDogY29sdW1uLmdldFRpdGxlKCkpIHx8ICcgJ1xyXG4gICAgY29sV2lkdGggKz0gY29sdW1uLnJlbmRlcldpZHRoXHJcbiAgICBpZiAoaXNIZWFkZXIpIHtcclxuICAgICAgY29sSGVhZFtjb2x1bW4uaWRdID0gdGl0bGVcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IGNvbHVtbi5pZCxcclxuICAgICAgcHJvbXB0OiB0aXRsZSxcclxuICAgICAgd2lkdGg6IGNvbHVtbi5yZW5kZXJXaWR0aFxyXG4gICAgfVxyXG4gIH0pXHJcbiAgY29uc3QgY29sUmF0aW8gPSBjb2xXaWR0aCAvIDEwMFxyXG4gIGhlYWRlcnMuZm9yRWFjaCgoY29sdW1uOiBhbnkpID0+IHtcclxuICAgIGNvbHVtbi53aWR0aCA9IE1hdGguZmxvb3IoY29sdW1uLndpZHRoIC8gY29sUmF0aW8gKiA0KSAtIDFcclxuICB9KVxyXG4gIGNvbnN0IHJvd0xpc3Q6IGFueVtdID0gZGF0YXMubWFwKChyb3c6IGFueSwgcm93SW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgY29uc3QgaXRlbTogYW55ID0ge31cclxuICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uOiBhbnksIGNvbHVtbkluZGV4OiBudW1iZXIpID0+IHtcclxuICAgICAgbGV0IGNlbGxWYWx1ZVxyXG4gICAgICBjb25zdCBwcm9wZXJ0eSA9IGNvbHVtbi5wcm9wZXJ0eVxyXG4gICAgICBjb25zdCBpc0luZGV4ID0gY29sdW1uLnR5cGUgPT09ICdpbmRleCdcclxuICAgICAgaWYgKCFvcmlnaW5hbCB8fCBpc0luZGV4KSB7XHJcbiAgICAgICAgY2VsbFZhbHVlID0gaXNJbmRleCA/IChjb2x1bW4uaW5kZXhNZXRob2QgPyBjb2x1bW4uaW5kZXhNZXRob2QoeyByb3csIHJvd0luZGV4LCBjb2x1bW4sIGNvbHVtbkluZGV4IH0pIDogcm93SW5kZXggKyAxKSA6IHJvd1tjb2x1bW4uaWRdXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2VsbFZhbHVlID0gWEVVdGlscy5nZXQocm93LCBwcm9wZXJ0eSlcclxuICAgICAgfVxyXG4gICAgICBpdGVtW2NvbHVtbi5pZF0gPSBYRVV0aWxzLnRvU3RyaW5nKGNlbGxWYWx1ZSkgfHwgJyAnXHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIGl0ZW1cclxuICB9KVxyXG4gIGlmIChpc0Zvb3Rlcikge1xyXG4gICAgY29uc3QgZm9vdGVyRGF0YTogYW55W10gPSAkdGFibGUuZm9vdGVyRGF0YVxyXG4gICAgY29uc3QgZm9vdGVyczogYW55W10gPSBmb290ZXJGaWx0ZXJNZXRob2QgPyBmb290ZXJEYXRhLmZpbHRlcihmb290ZXJGaWx0ZXJNZXRob2QpIDogZm9vdGVyRGF0YVxyXG4gICAgZm9vdGVycy5mb3JFYWNoKChyb3dzOiBhbnlbXSkgPT4ge1xyXG4gICAgICBjb25zdCBpdGVtOiBhbnkgPSB7fVxyXG4gICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbjogYW55KSA9PiB7XHJcbiAgICAgICAgaXRlbVtjb2x1bW4uaWRdID0gWEVVdGlscy50b1N0cmluZyhyb3dzWyR0YWJsZS5nZXRDb2x1bW5JbmRleChjb2x1bW4pXSkgfHwgJyAnXHJcbiAgICAgIH0pXHJcbiAgICAgIGZvb3RMaXN0LnB1c2goaXRlbSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIC8vIOi9rOaNonBkZlxyXG4gIGNvbnN0IGRvYyA9IG5ldyBqc1BERih7IHB1dE9ubHlVc2VkRm9udHM6IHRydWUsIG9yaWVudGF0aW9uOiAnbGFuZHNjYXBlJyB9KTtcclxuICBkb2MudGFibGUoMSwgMSwgKGlzSGVhZGVyID8gW2NvbEhlYWRdIDogW10pLmNvbmNhdChyb3dMaXN0KS5jb25jYXQoZm9vdExpc3QpLCBoZWFkZXJzLCB7IHByaW50SGVhZGVyczogZmFsc2UsIGF1dG9TaXplOiBmYWxzZSB9KTtcclxuICBkb2Muc2F2ZShgJHtmaWxlbmFtZX0uJHt0eXBlfWApXHJcbiAgaWYgKG1lc3NhZ2UgIT09IGZhbHNlKSB7XHJcbiAgICAkdGFibGUuJFhNb2RhbC5tZXNzYWdlKHsgbWVzc2FnZTogaTE4bigndnhlLnRhYmxlLmV4cFN1Y2Nlc3MnKSwgc3RhdHVzOiAnc3VjY2VzcycgfSlcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUV4cG9ydEV2ZW50KHBhcmFtczogYW55KSB7XHJcbiAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICdwZGYnKSB7XHJcbiAgICBleHBvcnRQREYocGFyYW1zKVxyXG4gICAgcmV0dXJuIGZhbHNlXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlop7lvLrmj5Lku7bvvIzmlK/mjIHlr7zlh7ogcGRmIOagvOW8j1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IFZYRVRhYmxlUGx1Z2luRXhwb3J0UERGOiBhbnkgPSB7XHJcbiAgaW5zdGFsbCh4dGFibGU6IHR5cGVvZiBWWEVUYWJsZSkge1xyXG4gICAgT2JqZWN0LmFzc2lnbih4dGFibGUudHlwZXMsIHsgcGRmOiAwIH0pXHJcbiAgICB4dGFibGUuaW50ZXJjZXB0b3IubWl4aW4oe1xyXG4gICAgICAnZXZlbnQuZXhwb3J0JzogaGFuZGxlRXhwb3J0RXZlbnRcclxuICAgIH0pXHJcbiAgICBWWEVUYWJsZVBsdWdpbkV4cG9ydFBERi50ID0geHRhYmxlLnRcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGkxOG4oa2V5OiBzdHJpbmcpIHtcclxuICBpZiAoVlhFVGFibGVQbHVnaW5FeHBvcnRQREYudCkge1xyXG4gICAgcmV0dXJuIFZYRVRhYmxlUGx1Z2luRXhwb3J0UERGLnQoa2V5KVxyXG4gIH1cclxufVxyXG5cclxuaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WWEVUYWJsZSkge1xyXG4gIHdpbmRvdy5WWEVUYWJsZS51c2UoVlhFVGFibGVQbHVnaW5FeHBvcnRQREYpXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luRXhwb3J0UERGXHJcbiJdfQ==
