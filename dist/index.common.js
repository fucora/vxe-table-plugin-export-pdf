"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginExportPDF = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils/methods/xe-utils"));

var _jspdf = _interopRequireDefault(require("jspdf"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function getFooterCellValue($table, opts, rows, column) {
  var cellValue = _xeUtils["default"].toString(rows[$table.$getColumnIndex(column)]);

  return cellValue;
}

function exportPDF(params) {
  var colWidth = 0;
  var options = params.options,
      columns = params.columns,
      datas = params.datas;
  var $table = params.$table;
  var treeConfig = $table.treeConfig,
      treeOpts = $table.treeOpts;
  var type = options.type,
      filename = options.filename,
      isHeader = options.isHeader,
      isFooter = options.isFooter,
      original = options.original,
      message = options.message,
      footerFilterMethod = options.footerFilterMethod;
  var footList = [];
  var headers = columns.map(function (column) {
    var title = _xeUtils["default"].toString(original ? column.property : column.getTitle()) || ' ';
    colWidth += column.renderWidth;
    return {
      name: column.id,
      prompt: title,
      width: column.renderWidth
    };
  });
  var rowList = [];
  var colRatio = colWidth / 100;
  headers.forEach(function (column) {
    column.width = Math.floor(column.width / colRatio * 4) - 1;
  });

  if (treeConfig) {
    rowList = datas.map(function (row) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = column.treeNode ? ' '.repeat(row._level * treeOpts.indent / 8) + row[column.id] : row[column.id];
      });
      return item;
    });
  } else {
    rowList = datas;
  }

  if (isFooter) {
    var _$table$getTableData = $table.getTableData(),
        footerData = _$table$getTableData.footerData;

    var footers = footerFilterMethod ? footerData.filter(footerFilterMethod) : footerData;
    footers.forEach(function (rows) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = getFooterCellValue($table, options, rows, column);
      });
      footList.push(item);
    });
  } // 转换pdf

  /* eslint-disable new-cap */


  var doc = new _jspdf["default"]({
    putOnlyUsedFonts: true,
    orientation: 'landscape'
  });
  doc.table(1, 1, rowList.concat(footList), headers, {
    printHeaders: isHeader,
    autoSize: false
  });
  doc.save("".concat(filename, ".").concat(type));

  if (message !== false) {
    $table.$XModal.message({
      message: i18n('vxe.table.expSuccess'),
      status: 'success'
    });
  }
}

function handleExportEvent(params) {
  if (params.options.type === 'pdf') {
    exportPDF(params);
    return false;
  }
}
/**
 * 基于 vxe-table 表格的增强插件，支持导出 pdf 格式
 */


var VXETablePluginExportPDF = {
  install: function install(xtable) {
    Object.assign(xtable.types, {
      pdf: 0
    });
    xtable.interceptor.mixin({
      'event.export': handleExportEvent
    });
    VXETablePluginExportPDF.t = xtable.t;
  }
};
exports.VXETablePluginExportPDF = VXETablePluginExportPDF;

function i18n(key) {
  if (VXETablePluginExportPDF.t) {
    return VXETablePluginExportPDF.t(key);
  }
}

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(VXETablePluginExportPDF);
}

var _default = VXETablePluginExportPDF;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbImdldEZvb3RlckNlbGxWYWx1ZSIsIiR0YWJsZSIsIm9wdHMiLCJyb3dzIiwiY29sdW1uIiwiY2VsbFZhbHVlIiwiWEVVdGlscyIsInRvU3RyaW5nIiwiJGdldENvbHVtbkluZGV4IiwiZXhwb3J0UERGIiwicGFyYW1zIiwiY29sV2lkdGgiLCJvcHRpb25zIiwiY29sdW1ucyIsImRhdGFzIiwidHJlZUNvbmZpZyIsInRyZWVPcHRzIiwidHlwZSIsImZpbGVuYW1lIiwiaXNIZWFkZXIiLCJpc0Zvb3RlciIsIm9yaWdpbmFsIiwibWVzc2FnZSIsImZvb3RlckZpbHRlck1ldGhvZCIsImZvb3RMaXN0IiwiaGVhZGVycyIsIm1hcCIsInRpdGxlIiwicHJvcGVydHkiLCJnZXRUaXRsZSIsInJlbmRlcldpZHRoIiwibmFtZSIsImlkIiwicHJvbXB0Iiwid2lkdGgiLCJyb3dMaXN0IiwiY29sUmF0aW8iLCJmb3JFYWNoIiwiTWF0aCIsImZsb29yIiwicm93IiwiaXRlbSIsInRyZWVOb2RlIiwicmVwZWF0IiwiX2xldmVsIiwiaW5kZW50IiwiZ2V0VGFibGVEYXRhIiwiZm9vdGVyRGF0YSIsImZvb3RlcnMiLCJmaWx0ZXIiLCJwdXNoIiwiZG9jIiwianNQREYiLCJwdXRPbmx5VXNlZEZvbnRzIiwib3JpZW50YXRpb24iLCJ0YWJsZSIsImNvbmNhdCIsInByaW50SGVhZGVycyIsImF1dG9TaXplIiwic2F2ZSIsIiRYTW9kYWwiLCJpMThuIiwic3RhdHVzIiwiaGFuZGxlRXhwb3J0RXZlbnQiLCJWWEVUYWJsZVBsdWdpbkV4cG9ydFBERiIsImluc3RhbGwiLCJ4dGFibGUiLCJPYmplY3QiLCJhc3NpZ24iLCJ0eXBlcyIsInBkZiIsImludGVyY2VwdG9yIiwibWl4aW4iLCJ0Iiwia2V5Iiwid2luZG93IiwiVlhFVGFibGUiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7OztBQUVBLFNBQVNBLGtCQUFULENBQTZC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TSxDQUFDQyxRQUFQLENBQWdCQyxHQUFoQixDQUFvQmIsdUJBQXBCO0FBQ0Q7O2VBRWNBLHVCIiwiZmlsZSI6ImluZGV4LmNvbW1vbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBYRVV0aWxzIGZyb20gJ3hlLXV0aWxzL21ldGhvZHMveGUtdXRpbHMnXHJcbmltcG9ydCB7IFZYRVRhYmxlLCBUYWJsZSwgSW50ZXJjZXB0b3JFeHBvcnRQYXJhbXMsIENvbHVtbkNvbmZpZywgRXhwb3J0T3B0b25zIH0gZnJvbSAndnhlLXRhYmxlL2xpYi92eGUtdGFibGUnIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcclxuaW1wb3J0IGpzUERGIGZyb20gJ2pzcGRmJ1xyXG5cclxuZnVuY3Rpb24gZ2V0Rm9vdGVyQ2VsbFZhbHVlICgkdGFibGU6IFRhYmxlLCBvcHRzOiBFeHBvcnRPcHRvbnMsIHJvd3M6IGFueVtdLCBjb2x1bW46IENvbHVtbkNvbmZpZykge1xyXG4gIHZhciBjZWxsVmFsdWUgPSBYRVV0aWxzLnRvU3RyaW5nKHJvd3NbJHRhYmxlLiRnZXRDb2x1bW5JbmRleChjb2x1bW4pXSlcclxuICByZXR1cm4gY2VsbFZhbHVlXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4cG9ydFBERiAocGFyYW1zOiBJbnRlcmNlcHRvckV4cG9ydFBhcmFtcykge1xyXG4gIGxldCBjb2xXaWR0aDogbnVtYmVyID0gMFxyXG4gIGNvbnN0IHsgb3B0aW9ucywgY29sdW1ucywgZGF0YXMgfSA9IHBhcmFtc1xyXG4gIGNvbnN0ICR0YWJsZTogYW55ID0gcGFyYW1zLiR0YWJsZVxyXG4gIGNvbnN0IHsgdHJlZUNvbmZpZywgdHJlZU9wdHMgfSA9ICR0YWJsZVxyXG4gIGNvbnN0IHsgdHlwZSwgZmlsZW5hbWUsIGlzSGVhZGVyLCBpc0Zvb3Rlciwgb3JpZ2luYWwsIG1lc3NhZ2UsIGZvb3RlckZpbHRlck1ldGhvZCB9ID0gb3B0aW9uc1xyXG4gIGNvbnN0IGZvb3RMaXN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9W10gPSBbXVxyXG4gIGNvbnN0IGhlYWRlcnM6IHsgW2tleTogc3RyaW5nXTogYW55IH1bXSA9IGNvbHVtbnMubWFwKChjb2x1bW4pID0+IHtcclxuICAgIGNvbnN0IHRpdGxlOiBzdHJpbmcgPSBYRVV0aWxzLnRvU3RyaW5nKG9yaWdpbmFsID8gY29sdW1uLnByb3BlcnR5IDogY29sdW1uLmdldFRpdGxlKCkpIHx8ICcgJ1xyXG4gICAgY29sV2lkdGggKz0gY29sdW1uLnJlbmRlcldpZHRoXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiBjb2x1bW4uaWQsXHJcbiAgICAgIHByb21wdDogdGl0bGUsXHJcbiAgICAgIHdpZHRoOiBjb2x1bW4ucmVuZGVyV2lkdGhcclxuICAgIH1cclxuICB9KVxyXG4gIGxldCByb3dMaXN0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9W10gPSBbXVxyXG4gIGNvbnN0IGNvbFJhdGlvID0gY29sV2lkdGggLyAxMDBcclxuICBoZWFkZXJzLmZvckVhY2goKGNvbHVtbikgPT4ge1xyXG4gICAgY29sdW1uLndpZHRoID0gTWF0aC5mbG9vcihjb2x1bW4ud2lkdGggLyBjb2xSYXRpbyAqIDQpIC0gMVxyXG4gIH0pXHJcbiAgaWYgKHRyZWVDb25maWcpIHtcclxuICAgIHJvd0xpc3QgPSBkYXRhcy5tYXAoKHJvdykgPT4ge1xyXG4gICAgICBjb25zdCBpdGVtOiBhbnkgPSB7fVxyXG4gICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xyXG4gICAgICAgIGl0ZW1bY29sdW1uLmlkXSA9IGNvbHVtbi50cmVlTm9kZSA/ICgnICcucmVwZWF0KHJvdy5fbGV2ZWwgKiB0cmVlT3B0cy5pbmRlbnQgLyA4KSArIHJvd1tjb2x1bW4uaWRdKSA6IHJvd1tjb2x1bW4uaWRdXHJcbiAgICAgIH0pXHJcbiAgICAgIHJldHVybiBpdGVtXHJcbiAgICB9KVxyXG4gIH0gZWxzZSB7XHJcbiAgICByb3dMaXN0ID0gZGF0YXNcclxuICB9XHJcbiAgaWYgKGlzRm9vdGVyKSB7XHJcbiAgICBjb25zdCB7IGZvb3RlckRhdGEgfSA9ICR0YWJsZS5nZXRUYWJsZURhdGEoKVxyXG4gICAgY29uc3QgZm9vdGVycyA9IGZvb3RlckZpbHRlck1ldGhvZCA/IGZvb3RlckRhdGEuZmlsdGVyKGZvb3RlckZpbHRlck1ldGhvZCkgOiBmb290ZXJEYXRhXHJcbiAgICBmb290ZXJzLmZvckVhY2goKHJvd3M6IGFueVtdKSA9PiB7XHJcbiAgICAgIGNvbnN0IGl0ZW06IGFueSA9IHt9XHJcbiAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XHJcbiAgICAgICAgaXRlbVtjb2x1bW4uaWRdID0gZ2V0Rm9vdGVyQ2VsbFZhbHVlKCR0YWJsZSwgb3B0aW9ucywgcm93cywgY29sdW1uKVxyXG4gICAgICB9KVxyXG4gICAgICBmb290TGlzdC5wdXNoKGl0ZW0pXHJcbiAgICB9KVxyXG4gIH1cclxuICAvLyDovazmjaJwZGZcclxuICAvKiBlc2xpbnQtZGlzYWJsZSBuZXctY2FwICovXHJcbiAgY29uc3QgZG9jID0gbmV3IGpzUERGKHsgcHV0T25seVVzZWRGb250czogdHJ1ZSwgb3JpZW50YXRpb246ICdsYW5kc2NhcGUnIH0pXHJcbiAgZG9jLnRhYmxlKDEsIDEsIHJvd0xpc3QuY29uY2F0KGZvb3RMaXN0KSwgaGVhZGVycywgeyBwcmludEhlYWRlcnM6IGlzSGVhZGVyLCBhdXRvU2l6ZTogZmFsc2UgfSlcclxuICBkb2Muc2F2ZShgJHtmaWxlbmFtZX0uJHt0eXBlfWApXHJcbiAgaWYgKG1lc3NhZ2UgIT09IGZhbHNlKSB7XHJcbiAgICAkdGFibGUuJFhNb2RhbC5tZXNzYWdlKHsgbWVzc2FnZTogaTE4bigndnhlLnRhYmxlLmV4cFN1Y2Nlc3MnKSwgc3RhdHVzOiAnc3VjY2VzcycgfSlcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUV4cG9ydEV2ZW50IChwYXJhbXM6IEludGVyY2VwdG9yRXhwb3J0UGFyYW1zKSB7XHJcbiAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICdwZGYnKSB7XHJcbiAgICBleHBvcnRQREYocGFyYW1zKVxyXG4gICAgcmV0dXJuIGZhbHNlXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlop7lvLrmj5Lku7bvvIzmlK/mjIHlr7zlh7ogcGRmIOagvOW8j1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IFZYRVRhYmxlUGx1Z2luRXhwb3J0UERGOiBhbnkgPSB7XHJcbiAgaW5zdGFsbCAoeHRhYmxlOiB0eXBlb2YgVlhFVGFibGUpIHtcclxuICAgIE9iamVjdC5hc3NpZ24oeHRhYmxlLnR5cGVzLCB7IHBkZjogMCB9KVxyXG4gICAgeHRhYmxlLmludGVyY2VwdG9yLm1peGluKHtcclxuICAgICAgJ2V2ZW50LmV4cG9ydCc6IGhhbmRsZUV4cG9ydEV2ZW50XHJcbiAgICB9KVxyXG4gICAgVlhFVGFibGVQbHVnaW5FeHBvcnRQREYudCA9IHh0YWJsZS50XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpMThuIChrZXk6IHN0cmluZykge1xyXG4gIGlmIChWWEVUYWJsZVBsdWdpbkV4cG9ydFBERi50KSB7XHJcbiAgICByZXR1cm4gVlhFVGFibGVQbHVnaW5FeHBvcnRQREYudChrZXkpXHJcbiAgfVxyXG59XHJcblxyXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlZYRVRhYmxlKSB7XHJcbiAgd2luZG93LlZYRVRhYmxlLnVzZShWWEVUYWJsZVBsdWdpbkV4cG9ydFBERilcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVlhFVGFibGVQbHVnaW5FeHBvcnRQREZcclxuIl19
